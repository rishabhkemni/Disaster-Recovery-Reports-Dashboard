
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Universal DR Dashboard | Datamotive Technologies</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    :root {
      --primary: #1e3a8a;
      --success: #16a34a;
      --danger: #dc2626;
      --warning: #f59e0b;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #e2e8f0, #f8fafc);
      padding: 20px;
    }

    .container-main {
      max-width: 1500px;
      margin: auto;
      background: white;
      border-radius: 22px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    header {
      background: linear-gradient(135deg, var(--primary), #0f172a);
      color: white;
      padding: 40px;
      text-align: center;
    }

    .upload-area {
      margin: 40px;
      padding: 70px;
      text-align: center;
      border-radius: 20px;
      border: 3px dashed #cbd5f5;
      background: #f8fafc;
      cursor: pointer;
    }

    .card-elevated {
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }

    .cycle-pass { border-top: 5px solid var(--success); }
    .cycle-fail { border-top: 5px solid var(--danger); }

    footer {
      padding: 18px;
      text-align: center;
      font-size: 0.9em;
      background: #f1f5f9;
    }
  </style>
</head>

<body>
  <div class="container-main">

    <header>
      <h1>Universal DR Dashboard</h1>
      <p>JSON â€¢ Excel â€¢ Text â†’ Unified Disaster Recovery Visualization</p>
      <div>Datamotive Technologies</div>
    </header>

    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
      <div style="font-size:4em;">ðŸ“Š</div>
      <p><strong>Drop JSON File Here</strong></p>
      <input type="file" id="fileInput" accept=".json,.txt" hidden />
    </div>

    <div id="dashboard" style="display:none; padding:30px;">

      <div class="row g-3" id="summaryGrid"></div>
      <div class="row g-3 mt-4" id="infraGrid"></div>
      <div id="cyclesGrid" class="mt-4"></div>

    </div>

    <footer>
      Â© Datamotive Technologies â€¢ Created by <strong>Rishabh Kemni</strong>
    </footer>

  </div>

<script>

document.getElementById('fileInput').addEventListener('change', function(e){
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function(evt){
    const data = JSON.parse(evt.target.result);
    renderDashboard(data);
  };
  reader.readAsText(file);
});

function renderDashboard(report){
  document.getElementById('dashboard').style.display = 'block';
  renderSummary(report);
  renderInfra(report);
  renderCycles(report);
}

function renderSummary(report){
  const cycles = report.testSuiteResults?.testCases || [];

  let totalExecuted = 0;
  let totalPassed = 0;
  let totalFailed = 0;

  cycles.forEach(cycleObj => {
    const key = Object.keys(cycleObj)[0];
    const tests = cycleObj[key] || [];
    totalExecuted += tests.length;
    totalPassed += tests.filter(t => t.status === "PASSED").length;
    totalFailed += tests.filter(t => t.status === "FAILED").length;
  });

  const totalSkipped = report.testSuiteResults?.skipped ?? 0;
  const overallStatus = totalFailed > 0 ? "FAIL" : "PASS";

  document.getElementById('summaryGrid').innerHTML = `
    <div class="col-md-2">
      <div class="card card-elevated p-3 text-center">
        <h4 class="${overallStatus==='PASS'?'text-success':'text-danger'}">${overallStatus}</h4>
        <small>Overall Status</small>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card card-elevated p-3 text-center">
        <h4>${totalExecuted}</h4>
        <small>Total Executed</small>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card card-elevated p-3 text-center">
        <h4 class="text-success">${totalPassed}</h4>
        <small>Passed</small>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card card-elevated p-3 text-center">
        <h4 class="text-danger">${totalFailed}</h4>
        <small>Failed</small>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card card-elevated p-3 text-center">
        <h4 class="text-warning">${totalSkipped}</h4>
        <small>Skipped</small>
      </div>
    </div>
  `;
}

function renderInfra(report){
  const nodes = report.nodes || [];
  const sourceNode = nodes.find(n => n.sourcePlatform);
  const targetNode = nodes.find(n => n.targetPlatform || n.tragetPlatform);

  document.getElementById('infraGrid').innerHTML = `
    <div class="col-md-6">
      <div class="card card-elevated p-3">
        <h5>Primary Site</h5>
        <div><strong>Platform:</strong> ${sourceNode?.sourcePlatform ?? 'N/A'}</div>
        <div><strong>IP:</strong> ${sourceNode?.sourceIp ?? 'N/A'}</div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card card-elevated p-3">
        <h5>DR Site</h5>
        <div><strong>Platform:</strong> ${(targetNode?.targetPlatform || targetNode?.tragetPlatform) ?? 'N/A'}</div>
        <div><strong>IP:</strong> ${targetNode?.targetIp ?? 'N/A'}</div>
      </div>
    </div>
  `;
}

function renderCycles(report){
  const cycles = report.testSuiteResults?.testCases || [];

  const html = cycles.map((cycleObj, index) => {

    const cycleName = Object.keys(cycleObj)[0];
    const tests = cycleObj[cycleName] || [];

    const passed = tests.filter(t => t.status === "PASSED").length;
    const failed = tests.filter(t => t.status === "FAILED").length;
    const total = tests.length;
    const passRate = total > 0 ? ((passed / total) * 100).toFixed(1) : 0;

    const statusClass = failed > 0 ? "cycle-fail" : "cycle-pass";
    const startTime = report.execution_metadata?.timestamp ?? 'N/A';
    const duration = cycleObj.duration_minutes ?? 'N/A';

    return `
      <div class="card card-elevated p-4 ${statusClass} mb-4">
        <div class="d-flex justify-content-between align-items-center">
          <h5>${cycleName.toUpperCase()}</h5>
          <span class="badge ${failed > 0 ? 'bg-danger' : 'bg-success'}">
            ${failed > 0 ? "FAILED" : "PASSED"}
          </span>
        </div>

        <div class="row text-center mt-3">
          <div class="col-md-3">
            <h4 class="text-success">${passed}</h4>
            <small>Passed</small>
          </div>
          <div class="col-md-3">
            <h4 class="text-danger">${failed}</h4>
            <small>Failed</small>
          </div>
          <div class="col-md-3">
            <h4 class="text-primary">${passRate}%</h4>
            <small>Pass Rate</small>
          </div>
          <div class="col-md-3">
            <small><strong>Start:</strong> ${startTime}</small><br>
            <small><strong>Duration:</strong> ${duration}</small>
          </div>
        </div>

        <div class="accordion mt-3" id="accordion${index}">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapse${index}">
                View Test Cases (${total})
              </button>
            </h2>
            <div id="collapse${index}" class="accordion-collapse collapse">
              <div class="accordion-body">

                <input type="text" class="form-control mb-3"
                  placeholder="Search test case..."
                  onkeyup="filterTests(this,'table${index}')">

                <table class="table table-striped table-bordered" id="table${index}">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${tests.map(t => `
                      <tr>
                        <td>${t.testId}</td>
                        <td>${t.testName}</td>
                        <td class="${t.status === "PASSED" ? "text-success" : "text-danger"} fw-bold">
                          ${t.status}
                        </td>
                      </tr>
                    `).join("")}
                  </tbody>
                </table>

              </div>
            </div>
          </div>
        </div>

      </div>
    `;

  }).join("");

  document.getElementById('cyclesGrid').innerHTML = html;
}

function filterTests(input, tableId){
  const filter = input.value.toLowerCase();
  const rows = document.querySelectorAll(`#${tableId} tbody tr`);
  rows.forEach(row => {
    row.style.display = row.innerText.toLowerCase().includes(filter) ? "" : "none";
  });
}

</script>

</body>
</html>
